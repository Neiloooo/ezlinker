#  第一部分：EZLinker一期需求

*时间：2019年11月3日星期日*

### 

## 1. 用户

### 1.账户相关

1. #### 登陆账号

   用户通过用户名/手机号密码组合登陆。

2. #### 注册账号

   用户名、手机号、密码进行注册。

3. #### 短信验证码

   用来注册和找回密码。

4. #### 邮箱验证码

   验证邮箱是为了左邮件推送。

5. #### 找回密码

   使用手机号验证码形式找回密码。

### 2.个人信息

1. #### 个人详情

   个人基本资料。

2. #### 更新信息

   更新个人基本资料

### 3.站内信处理

1. #### 查看站内信

   未读列表、已读列表，和消息详情

2. #### 标记站内信

   标记已读，或者删除

## 4. 产品

1. #### 新建产品

2. #### 修改产品

3. #### 删除产品

4. #### 查找产品

5. #### 增加功能

6. #### 编辑功能

7. #### 删除功能

8. #### 查看状态

9. #### 查看日志

## 5. 模块

1. #### 新建模块

2. #### 修改模块

3. #### 删除模块

4. #### 查找模块

5. #### 操作模块

6. #### 实现功能

7. #### 查看状态

8. #### 查看日志

 

## 6. 功能

1. #### 新建功能

2. #### 删除功能

3. #### 编辑功能



# 第二部分：一期数据库设计

 

本章节记录一期数据库表结构设计

2019年11月2日星期六

### 1.  用户

- 核心数据

| user     |                 |           |      |      |                       |
| -------- | --------------- | --------- | ---- | ---- | --------------------- |
| 字段名   | 字段            | 类型      | 长度 | 可空 | 备注                  |
| 主键     | id              | LONG      | 11   | ×    | PK,自增长             |
| 用户名   | username        | STRING    | 50   | ×    |                       |
| 登陆密码 | password        | STRING    | 64   | ×    | 64位HASH              |
| 用户头像 | avatar          | STRING    | 100  | √    | 头像                  |
| 手机号码 | phone           | STRING    | 11   | ×    | 11位国内              |
| 电子邮箱 | email           | STRING    | 20   | √    | 123@qq.com            |
| 真实姓名 | real_name       | STRING    | 10   | √    | 张晓明                |
| 昵称     | nick_name       | STRING    | 20   | √    | 昵称                  |
| 用户类型 | user_type       | INT       | 4    | ×    | 个人：1企业：2        |
| 账户状态 | status          | INT       | 4    | ×    | 正常：1冻结：2过期：3 |
| 扩展信息 | profile_id      | LONG      | 11   | ×    | 扩展外键ID            |
| 上次登录 | last_login_time | DATE_TIME | --   | ×    | 上次登录时间          |
| 登陆IP   | last_login_ip   | STRING    | 16   |      | 上次登录IP            |
| 创建时间 | create_time     | DATE_TIME | --   | ×    |                       |

- 扩展数据

| user_profile |                 |        |      |      |            |
| ------------ | --------------- | ------ | ---- | ---- | ---------- |
| 字段名       | 字段            | 类型   | 长度 | 可空 | 备注       |
| 主键         | id              | LONG   | 11   | √    | PK,自增长  |
| 地区         | region          | STRING | 50   | √    | 国家、地区 |
| 省           | province        | STRING | 10   | √    | 所在省     |
| 市           | city            | STRING | 10   | √    | 所在市     |
| 区           | area            | STRING | 10   | √    | 所在县、区 |
| 地址         | address         | STRING | 20   | √    | 详细地址   |
| 行业         | domain          | STRING | 50   | √    | 所属行业   |
| 个人备注     | personal_remark | STRING | 200  | √    | 自我介绍   |
| 实名认证     | real_name       | INT    | 4    | √    | 实名状态   |
| QQ           | qq              | STRING | 12   | √    | QQ号       |
| 扩展。。     | ...             | ...    |      |      |            |

### 2. 角色

| role     |             |           |      |      |                                |
| -------- | ----------- | --------- | ---- | ---- | ------------------------------ |
| 字段名   | 字段        | 类型      | 长度 | 可空 | 备注                           |
| 主键     | id          | LONG      | 11   | ×    | PK                             |
| 角色名称 | name        | STRING    | 20   | ×    | 角色名称：例如管理员，普通用户 |
| 标签     | label       | STRING    | 20   | ×    | UI显示的文本                   |
| 父级角色 | parent      | LONG      | 11   | √    | 父角色ID                       |
| 角色描述 | description | STRING    | 100  | ×    | 描述文本                       |
| 创建时间 | create_time | DATE_TIME | --   | ×    |                                |

### 3. 权限

| permission |             |           |      |      |                                      |
| ---------- | ----------- | --------- | ---- | ---- | ------------------------------------ |
| 字段名     | 字段        | 类型      | 长度 | 可空 | 备注                                 |
| 主键       | id          | LONG      | 11   | ×    | PK                                   |
| 权限名称   | name        | STRING    | 20   | ×    | 权限名称：新增设备、删除设备。。。。 |
| 标签       | label       | STRING    | 20   | ×    | UI显示的文本                         |
| 资源路径   | resource    | STRING    | 20   | ×    | URL                                  |
| 资源类型   | type        | INT       | 4    | ×    | 1:目录2:页面                         |
| 父级权限   | parent      | LONG      | 11   | √    | 父权限ID                             |
| 权限描述   | description | STRING    | 100  | ×    | 描述文本                             |
| 创建时间   | create_time | DATE_TIME | --   | ×    |                                      |

### 4. 用户-角色

| user_role |             |           |      |      |        |
| --------- | ----------- | --------- | ---- | ---- | ------ |
| 字段名    | 字段        | 类型      | 长度 | 可空 | 备注   |
| 主键      | id          | LONG      | 11   | ×    | PK     |
| 用户      | user_id     | LONG      | 11   | ×    | 用户ID |
| 角色      | role_id     | LONG      | 11   | ×    | 角色ID |
| 创建时间  | create_time | DATE_TIME | --   | ×    |        |

### 5. 角色-权限

| role_permission |               |           |      |      |        |
| --------------- | ------------- | --------- | ---- | ---- | ------ |
| 字段名          | 字段          | 类型      | 长度 | 可空 | 备注   |
| 主键            | id            | LONG      | 11   | ×    | PK     |
| 角色            | role_id       | LONG      | 11   | ×    | 角色ID |
| 权限            | permission_id | LONG      | 11   | ×    | 权限ID |
| 创建时间        | create_time   | DATE_TIME | --   | ×    |        |

### 6. 项目

| project  |             |           |      |      |            |
| -------- | ----------- | --------- | ---- | ---- | ---------- |
| 字段名   | 字段        | 类型      | 长度 | 可空 | 备注       |
| 主键     | id          | LONG      | 11   | ×    | PK         |
| 项目名   | name        | STRING    | 20   | ×    | 名称       |
| 项目logo | logo        | STRING    | 200  | √    | Logo       |
| 用户     | user_id     | LONG      | 11   | ×    | 关联用户ID |
| 项目描述 | description | STRING    | 20   | √    | 简介       |
| 地理位置 | location    | STRING    | 20   | √    | 地理位置   |
| 创建时间 | create_time | DATE_TIME | --   | ×    |            |

### 7. 产品

| product  |             |                                                        |      |      |                                                              |
| -------- | ----------- | ------------------------------------------------------ | ---- | ---- | ------------------------------------------------------------ |
| 字段名   | 字段        | 类型                                                   | 长度 | 可空 | 备注                                                         |
| 主键     | id          | LONG                                                   | 11   | ×    | PK                                                           |
| 产品名   | name        | STRING                                                 | 20   | ×    | 名称                                                         |
| 产品logo | logo        | STRING                                                 | 200  | √    | Logo                                                         |
| 产品描述 | description | STRING                                                 | 20   | √    | 简介                                                         |
| 地理位置 | location    | STRING                                                 | 20   | √    | 地理位置                                                     |
| 型号     | model       | STRING                                                 | 20   | √    | 比如I9-9900                                                  |
| 标签     | tag         | STRING                                                 | 20   | √    | 标签，用来分类用                                             |
| 厂家     | industry    | STRING                                                 | 20   | √    | 统一编码，比如富士康：FSK                                    |
| 批号     | sn          | STRING                                                 | 20   | √    | GUID：唯一识别号                                             |
| 类型     | type        | INT                                                    | 4    | ×    | 1.企业产品<br>2.军用产品<br>3.工业产品<br>4.农业产品<br>5.消费产品 |
| 产品参数 | parameter   | JSON：<br>{<br>key:"tmp”,<br>name:”温度”<br>｝<br>     |      | ×    | 产品的运行参数<br/>比如温湿度传感器，指定参数为：Tmp，Hum    |
| 运行状态 | status      | JSON：<br/>{<br/>key:”overload”,<br/>name:”过载”<br/>} |      | ×    | 产品的运行状态<br/>比如过载，流量不足等等运行时状态          |
| 项目     | project_id  | LONG                                                   |      | √    | 关联项目ID                                                   |
| 创建时间 | create_time | DATE_TIME                                              | --   | ×    |                                                              |

### 8. 模块

| component |              |           |      |      |                                                              |
| --------- | ------------ | --------- | ---- | ---- | ------------------------------------------------------------ |
| 字段名    | 字段         | 类型      | 长度 | 可空 | 备注                                                         |
| 主键      | id           | LONG      | 11   | ×    | PK                                                           |
| 模块名    | name         | STRING    | 20   | ×    | 名称                                                         |
| 描述      | description  | STRING    | 20   | √    | 简介                                                         |
| 模块协议  | protocol     | STRING    | 20   | ×    | 模块支持的协议类型，比如Mqtt，Tcp，Udp等等                   |
| 模块版本  | version      | STRING    | 20   | ×    | 一般用来升级固件用                                           |
| 型号      | model        | STRING    | 20   | √    | 比如I9-9900                                                  |
| 标签      | tag          | STRING    | 20   | √    | 标签，用来分类用                                             |
| 厂家      | industry     | STRING    | 20   | √    | 统一编码，比如富士康：FSK                                    |
| 批号      | sn           | STRING    | 20   | √    | GUID：唯一识别号                                             |
| token     | token        | STRING    | 200  | ×    | 上传数据的时候唯一凭证，在Mqtt里面是ClientId，在Coap和http或者TCP里面是个Token。 |
| 超级特权  | is_superuser | INT       | 4    | ×    | 0:有1:无特权Topic可以监控任何客户端                          |
| 产品      | product_id   | LONG      | 11   | √    | 产品ID                                                       |
| 创建时间  | create_time  | DATE_TIME | --   | ×    |                                                              |

如果是Mqtt设备，则消息交换形式是通过Topic。

1. ##### Topic

| topic    |             |           |      |      |                     |
| -------- | ----------- | --------- | ---- | ---- | ------------------- |
| 字段名   | 字段        | 类型      | 长度 | 可空 | 备注                |
| 主键     | id          | LONG      | 11   | ×    | PK                  |
| 路由     | topic       | STRING    | 100  | ×    | Mqtt的topic         |
| 权限     | access      | INT       | 4    | ×    | 1:SUB2:PUB3:PUB&SUB |
| ip       | ip          | STRING    | 16   | ×    | IP地址过滤          |
| 开通状态 | allow       | INT       | 4    | ×    | 0:未开通2:开通      |
| 创建时间 | create_time | DATE_TIME | --   | ×    |                     |

如果是其他的协议，暂时叫入口（Entry）。

2. ##### Entry

| entry    |             |           |      |      |                                                              |
| -------- | ----------- | --------- | ---- | ---- | ------------------------------------------------------------ |
| 字段名   | 字段        | 类型      | 长度 | 可空 | 备注                                                         |
| 主键     | id          | LONG      | 11   | ×    | PK                                                           |
| 权限     | access      | INT       | 4    | ×    | 1:SUB2:PUB3:PUB&SUB                                          |
| 端点     | endpoint    | STRING    | 40   | ×    | 客户端独有的域名，是客户端ID用Base64加密后的URL。<br>每个模块只能给自己的端点发送消息：<br>http://1.1.1.1:8080/component/endpoint/3R46tgug34h, |
| ip       | ip          | STRING    | 16   | ×    | IP地址过滤                                                   |
| 开通状态 | allow       | INT       | 4    | ×    | 0:未开通2:开通                                               |
| 创建时间 | create_time | DATE_TIME | --   | ×    |                                                              |

### 9. 功能

| future   |             |           |      |      |                                                           |
| -------- | ----------- | --------- | ---- | ---- | :-------------------------------------------------------- |
| 字段名   | 字段        | 类型      | 长度 | 可空 | 备注                                                      |
| 主键     | id          | LONG      | 11   | ×    | PK                                                        |
| 标签     | label       | STRING    | 20   | ×    | UI显示                                                    |
| 类型     | type        | INT       | 4    | ×    | 目前还没想好怎么分类，暂时就一个类：1:指令2:其他。。。    |
| 产品     | product_id  | LONG      | 11   | ×    | 产品ID                                                    |
| 名称     | name        | STRING    | 20   | ×    | 产品的功能                                                |
| 指令名称 | cmd_key     | STRING    | 20   | ×    | 客户端接收到的指令KEY                                     |
| 指令内容 | cmd_value   | STRING    | 40   | ×    | 指令的内容，比如给客户端发送了一个CMD指令，内容是ifconfig |
| 创建时间 | create_time | DATE_TIME | --   | ×    | --                                                        |

### 10. 站内信

| internel_message |             |        |      |      |                                        |
| ---------------- | ----------- | ------ | ---- | ---- | -------------------------------------- |
| 字段名           | 字段        | 类型   | 长度 | 可空 | 备注                                   |
| 主键             | id          | LONG   | 11   | X    | PK                                     |
| 类型             | type        | INT    | 4    | X    | 1:系统消息；2：设备消息；3：运行时消息 |
| 内容             | content     | STRING | 200  | X    | 文本内容                               |
| 标题             | title       | STRING | 100  | X    | 消息标题                               |
| 状态             | status      | INT    | 4    | X    | 0：未读，1：已读                       |
| 用户             | user_id     | LONG   | 11   | X    | 用户ID                                 |
| 创建时间         | create_time | --     | --   | X    | --                                     |

### 11. 用户登陆日志

| user_login_log |             |        |      |      |                          |
| -------------- | ----------- | ------ | ---- | ---- | ------------------------ |
| 字段名         | 字段        | 类型   | 长度 | 可空 | 备注                     |
| 主键           | id          | LONG   | 11   | X    | PK                       |
| IP             | ip          | INT    | 4    | X    | 登陆IP地址               |
| 备注           | remark      | STRING | 200  | X    | XXXX时间在XXX处登陆      |
| 地址           | location    | STRING | 100  | X    | 具体登陆地址，根据IP查找 |
| 状态           | status      | INT    | 4    | X    | 1：正常，2：警告         |
| 用户           | user_id     | LONG   | 11   | X    | 用户ID                   |
| 创建时间       | create_time | --     | --   | X    | --                       |